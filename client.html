<!doctype html>
<html>
<head>
	<title>Visualization of food consumption and daily nutrition on screen</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="client.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
	<script src="https://cdnjs.com/libraries/Chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
	<script> 
		function showHistory(foodType){
			socket.emit('sceenRequestHistoryData', foodType);
		}
	</script>

	<style>
	body { margin: 5px; padding: 0; box-sizing: border-box; }
	body { font: 13px Helvetica, Arial; }
	#scale-data-milk, #scale-data-broccoli, #scale-data-fish, #scale-data-orange, #scale-data-meat, #scale-data-unit, #title, #scale-data-calcium, #scale-data-calories, #scale-data-fat, #scale-data-protein,#scale-data-vitaminC { font-size: 22px; pointer-events: auto!important;padding-bottom: 5px;}
	.progress-bar-vertical { display: inline-block; width: 200px; height: 40px; -webkit-transform: rotate(-90deg); /* Chrome, Safari, Opera */ transform: rotate(-90deg); }
	.progress-bar-weight {background-color: #b2d4b0 !important;}
	.progress-bar-nutrients {background-color: #d2b0d4 !important;}

	#chartDiv{width: 20%; margin: 35px; auto;}

	#milkHistory{left: 50px; top:400px; position: absolute;}
	#orangeHistory{left: 260px; top:400px; position: absolute;}
	#meatHistory{left: 470px; top:400px; position: absolute;}
	#broccoliHistory{left: 680px; top:400px; position: absolute;}
	#fishHistory{left: 890px; top:400px; position: absolute;}

	#calciumIntake{left: 50px; top:1020px; position: absolute;}
	#caloriesIntake{left: 260px; top:1020px; position: absolute;}
	#fatIntake{left: 470px; top:1020px; position: absolute;}
	#proteinIntake{left: 680px; top:1020px; position: absolute;}
	#vitaminCIntake{left: 890px; top:1020px; position: absolute;}
</style>
</head> 
<body>

	<div class="container" style="background-color: #F4ECF5">
		<div><h3 align="center">Food Weight</h3></div>
		<!-- scale data area on the webpage-->
		<div class="row text-center" style = "padding-top: 5px;">
			<div class="col-sm-2">
				<p id="scale-data-milk">0</p> 
				<div style="text-align:center; padding-left: 10px">
					<button type="button" id="virtualMilkWeightPlus">+</button>
					<button type="button" id="virtualMilkWeightSubtract">-</button>
				</div>
			</div>
			<div class="col-sm-2">
				<p id="scale-data-orange">0</p>
				<div style="text-align:center; padding-left: 24px">
					<button type="button" id="virtualOrangeWeightPlus">+</button>
					<button type="button" id="virtualOrangeWeightSubtract">-</button>
				</div>
			</div>
			<div class="col-sm-2">
				<p id="scale-data-meat">0</p>
				<div style="text-align:center; padding-left: 42px">
					<button type="button" id="virtualMeatWeightPlus" aligh>+</button>
					<button type="button" id="virtualMeatWeightSubtract">-</button>
				</div>
			</div>
			<div class="col-sm-2">
				<p id="scale-data-broccoli">0</p>
				<div style="text-align:center; padding-left: 58px">
					<button type="button" id="virtualBroccoliWeightPlus">+</button>
					<button type="button" id="virtualBroccoliWeightSubtract">-</button>
				</div>
			</div>
			<div class="col-sm-2">
				<p id="scale-data-fish">0</p>
				<div style="text-align:center; padding-left: 74px">
					<button type="button" id="virtualFishWeightPlus">+</button>
					<button type="button" id="virtualFishWeightSubtract">-</button>
				</div>
			</div>
			<div class="col-sm-2"><p id="scale-data-unit">g</p></div>
		</div>


		<div class="row text-left" style = "padding-top: 90px;">
			<div class="row progress progress-bar-vertical col center-block">
				<div id="theprogressbarMilk" class="progress-bar progress-bar-weight" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 100px"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="theprogressbarOrange" class="progress-bar progress-bar-weight" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 80px"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="theprogressbarMeat" class="progress-bar progress-bar-weight" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="theprogressbarBroccoli" class="progress-bar progress-bar-weight" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="theprogressbarFish" class="progress-bar progress-bar-weight" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
		</div>

		<div class="row text-center" style = "padding-top: 80px;">
			<div class="col-sm-2" id="title" onclick="showHistory('milk');">Milk</div>
			<div class="col-sm-2" id="title" onclick="showHistory('orange');" style="padding-left: 30px;">Orange</div>
			<div class="col-sm-2" id="title" onclick="showHistory('meat');" style="padding-left: 55px;">Meat</div>
			<div class="col-sm-2" id="title" onclick="showHistory('broccoli');"style="padding-left: 70px;">Broccoli</div>
			<div class="col-sm-2" id="title" onclick="showHistory('fish');"style="padding-left: 90px;">Fish</div>
		</div>


		<!-- bar chart -->
		<div class="container" id = "chartDiv">
			<div><canvas id="milkHistory" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="orangeHistory" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="meatHistory" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="broccoliHistory" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="fishHistory" style="display: none;" width="100" height="100"></canvas></div>
		</div>

	</div>


	<div>&nbsp;</div>
	<div>&nbsp;</div>
	<div>&nbsp;</div>


	<div class="container" style="background-color: #ABDDC0;">
		<div><h3 align="center">Nutrients You Got Today</h3></div>
		<!-- scale data area on the webpage-->
		<div class="row text-center" style = "padding-top: 5px;">
			<div class="col-sm-2"><p id="scale-data-calcium">0 mg</p></div>
			<div class="col-sm-2"><p id="scale-data-calories">0 Cal</p></div>
			<div class="col-sm-2"><p id="scale-data-fat">0 g</p></div>
			<div class="col-sm-2"><p id="scale-data-protein">0 g</p></div>
			<div class="col-sm-2 text-right"><p id="scale-data-vitaminC">0 mg</p></div>
		</div>

		<div class="row" style = "padding-top: 90px;">
			<div class="row progress progress-bar-vertical col center-block">
				<div id="nutrientsCalcium" class="progress-bar progress-bar-nutrients" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 100px"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="nutrientsCalories" class="progress-bar progress-bar-nutrients" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 120px"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="nutrientsFat" class="progress-bar progress-bar-nutrients" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="nutrientsProtein" class="progress-bar progress-bar-nutrients" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
			<div class="row progress progress-bar-vertical col center-block">
				<div id="nutrientsVitaminA" class="progress-bar progress-bar-nutrients" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
		</div>

		<div class="row text-center" style = "padding-top: 80px;">
			<div class="col-sm-2" id="title" style="padding-left: 10px;">Calcium</div>
			<div class="col-sm-2" id="title" style="padding-left: 30px;">Calories</div>
			<div class="col-sm-2" id="title" style="padding-left: 50px;">Fat</div>
			<div class="col-sm-2" id="title" style="padding-left: 70px;">Protein</div>
			<div class="col-sm-2 text-right" id="title">Vitamin C</div>
		</div>

		<!-- bar chart -->
		<div class="container" id = "chartDiv">
			<div><canvas id="calciumIntake" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="caloriesIntake" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="fatIntake" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="proteinIntake" style="display: none;" width="100" height="100"></canvas></div>
		</div>
		<div class="container" id = "chartDiv">
			<div><canvas id="vitaminCIntake" style="display: none;" width="100" height="100"></canvas></div>
		</div>

	</div>

	<script>
		var socket = io.connect('https://192.168.0.100:3000',{secure: true});
		var maxWeight = 1000;
		var historyBar = ["milkHistory", "orangeHistory", "meatHistory", "broccoliHistory", "fishHistory"];
		var historyTitle = ["Milk consumption history", "Orange consumption history", "Meat consumption history", "Broccoli consumption history", "Fish consumption history"]
		var nutrientsIntakeBar = ["calciumIntake", "caloriesIntake", "fatIntake", "proteinIntake", "vitaminCIntake"];
		var nutrionLabels = ["Milk", "Orange", "Meat", "Broccoli", "Fish"];
		var nutritionTitle = ["Daily intake of calcium", "Daily intake of calories", "Daily intake of fat", "Daily intake of protein", "Daily intake of vitamin C"];
		var nutrientUnit = ["mg","Cal","g","g","mg"];
		var color = ["#4CC3D9","#FCE300"];
		var foodIsSelectedArray =[0,0,0,0,0];
		var milkIsSelected = false;
		var orangeIsSelected = false;
		var meatIsSelected = false;
		var broccoliIsSelected = false;
		var fishIsSelected = false;
		var numberOfFoodIsSelected = 0;
		var colorArray = ["#4CC3D9", "#4CC3D9", "#4CC3D9", "#4CC3D9", "#4CC3D9"];


    // Set milke weight data, max 1kg
    socket.on('scaleDataMilk', function(milk){
    	console.log("Milk " + milk);
    	var percentageMilk = milk/maxWeight * 100;
    	$('#scale-data-milk').text(milk);
    	$('#theprogressbarMilk').attr('aria-valuenow', percentageMilk).css('width', percentageMilk + '%');
    });

    // Set orange weight data, max 1kg
    socket.on('scaleDataOrange', function(orange){
    	console.log("Orange " + orange);
    	var percentageOrange = orange/maxWeight * 100;
    	$('#scale-data-orange').text(orange);
    	$('#theprogressbarOrange').attr('aria-valuenow', percentageOrange).css('width', percentageOrange + '%');
    }); 

    // Set meat weight data, max 1kg
    socket.on('scaleDataMeat', function(meat){
    	console.log("Meat " + meat);
    	var percentageMeat = meat/maxWeight * 100;
    	$('#scale-data-meat').text(meat);
    	$('#theprogressbarMeat').attr('aria-valuenow', percentageMeat).css('width', percentageMeat + '%');
    });

    // Set brocoli weight data, max 1kg
    socket.on('scaleDataBroccoli', function(broccoli){
    	console.log("Broccoli " + broccoli);
    	var percentageBroccoli = broccoli/maxWeight * 100;
    	$('#scale-data-broccoli').text(broccoli);
    	$('#theprogressbarBroccoli').attr('aria-valuenow', percentageBroccoli).css('width', percentageBroccoli + '%');
    });

    // Set fish weight data, max 1kg 
    socket.on('scaleDataFish', function(fish){
    	console.log("Fish " + fish);
    	var percentageFish = fish/maxWeight * 100;
    	$('#scale-data-fish').text(fish);
    	$('#theprogressbarFish').attr('aria-valuenow', percentageFish).css('width', percentageFish + '%');
    });



    // Deal with manually change the weight of milk, more milk consumption or less
    socket.on('manualDataMilk', function(milk){
    	console.log("Manual milk weight " + milk);
    	var percentageMilk = milk/1000 * 100;
    	$('#scale-data-milk').text(milk);
    	$('#theprogressbarMilk').attr('aria-valuenow', percentageMilk).css('width', percentageMilk + '%');
    });

    // Deal with manually change the weight of orange
    socket.on('manualDataOrange', function(orange){
    	console.log("Manual orange weight " + orange);
    	var percentageOrange = orange/1000 * 100;
    	$('#scale-data-milk').text(orange);
    	$('#theprogressbarMilk').attr('aria-valuenow', percentageOrange).css('width', percentageOrange + '%');
    });

    // Set meat weight data, max 5kg
    socket.on('manualDataMeat', function(meat){
    	console.log("Manual meat weight" + meat);
    	var percentageMeat = meat/1000 * 100;
    	$('#scale-data-meat').text(meat);
    	$('#theprogressbarMeat').attr('aria-valuenow', percentageMeat).css('width', percentageMeat + '%');
    });

    // Set brocoli weight data, max 1kg
    socket.on('manualDataBroccoli', function(broccoli){
    	console.log(" Manual broccoli weight" + broccoli);
    	var percentageBroccoli = broccoli/1000 * 100;
    	$('#scale-data-broccoli').text(broccoli);
    	$('#theprogressbarBroccoli').attr('aria-valuenow', percentageBroccoli).css('width', percentageBroccoli + '%');
    });

    // Set fish weight data, max 1kg
    socket.on('manualDataFish', function(fish){
    	console.log(" Manual fish weight" + fish);
    	var percentageFish = fish/1000 * 100;
    	$('#scale-data-fish').text(fish);
    	$('#theprogressbarFish').attr('aria-valuenow', percentageFish).css('width', percentageFish + '%');
    });

    socket.on('screenMilkHistory', function(historyData, milk, orange, meat, broccoli, fish){
    	drawHistoryDigram(historyData,0);
    	milkIsSelected = checkIfSelected(milkIsSelected);
    	if(milkIsSelected){
    		colorArray[0] = "#FCE300";
    		foodIsSelectedArray[0] = 1;
    		numberOfFoodIsSelected += 1;
    		drawAllNutrients(milk, orange, meat, broccoli, fish);
    	}
    	else{
    		colorArray[0] = "#4CC3D9";
    		numberOfFoodIsSelected -= 1;
    		if(numberOfFoodIsSelected == 0){
    			hideAllNutrients();
    		}
    		else{
    			hideNutrients(0);
    		}
    		hideHistory(0);
    	}
    	
    });

    socket.on('screenOrangeHistory', function(historyData, milk, orange, meat, broccoli, fish){
    	drawHistoryDigram(historyData,1);
    	orangeIsSelected = checkIfSelected(orangeIsSelected);
    	if(orangeIsSelected){
    		colorArray[1] = "#FCE300";
    		foodIsSelectedArray[1] = 1;
    		numberOfFoodIsSelected += 1;
    		drawAllNutrients(milk, orange, meat, broccoli, fish);
    	}
    	else{
    		colorArray[1] = "#4CC3D9";
    		numberOfFoodIsSelected -= 1;
    		if(numberOfFoodIsSelected == 0){
    			hideAllNutrients();
    		}
    		else{
    			hideNutrients(1, milk, orange, meat, broccoli, fish);
    		}
    		hideHistory(1);
    	}

    });

    socket.on('screenMeatHistory', function(historyData, milk, orange, meat, broccoli, fish){
    	drawHistoryDigram(historyData,2);
    	meatIsSelected = checkIfSelected(meatIsSelected);
    	if(meatIsSelected){
    		colorArray[2] = "#FCE300";
    		foodIsSelectedArray[2] = 1;
    		numberOfFoodIsSelected += 1;
    		drawAllNutrients(milk, orange, meat, broccoli, fish);
    	}
    	else{
    		colorArray[2] = "#4CC3D9";
    		numberOfFoodIsSelected -= 1;
    		if(numberOfFoodIsSelected == 0){
    			hideAllNutrients();
    		}
    		else{
    			hideNutrients(2, milk, orange, meat, broccoli, fish);
    		}
    		hideHistory(2);
    	}

    });

    socket.on('screenBroccoliHistory', function(historyData, milk, orange, meat, broccoli, fish){
    	drawHistoryDigram(historyData,3);
    	broccoliIsSelected = checkIfSelected(broccoliIsSelected);
    	if(broccoliIsSelected){
    		colorArray[3] = "#FCE300";
    		numberOfFoodIsSelected += 1;
    		drawAllNutrients(milk, orange, meat, broccoli, fish);
    	}
    	else{
    		colorArray[3] = "#4CC3D9";
    		numberOfFoodIsSelected -= 1;
    		if(numberOfFoodIsSelected == 0){
    			hideAllNutrients();
    		}
    		else{
    			hideNutrients(3, milk, orange, meat, broccoli, fish);
    		}
    		hideHistory(3);
    	}
    });

    socket.on('screenFishHistory', function(historyData, milk, orange, meat, broccoli, fish){
    	drawHistoryDigram(historyData,4);
    	fishIsSelected = checkIfSelected(fishIsSelected);
    	if(fishIsSelected){
    		colorArray[4] = "#FCE300";
    		numberOfFoodIsSelected += 1;
    		drawAllNutrients(milk, orange, meat, broccoli, fish);
    	}
    	else{
    		colorArray[4] = "#4CC3D9";
    		numberOfFoodIsSelected -= 1;
    		if(numberOfFoodIsSelected == 0){
    			hideAllNutrients();
    		}
    		else{
    			hideNutrients(4, milk, orange, meat, broccoli, fish);
    		}
    		hideHistory(4);
    	}

    });

	// Check select and deselect
	function checkIfSelected(flag){
		if(flag == true){
			flag = false;
		}
		else{
			flag = true;
		}
		return flag;
	}

    // Draw food historical consumotion chart
    function drawHistoryDigram(historyData, index){
    	for(i = 0; i < historyBar.length; i++){
    		var chart = document.getElementById(historyBar[index]);
    		chart.style.display = "inline-block";
    		var myChart = new Chart(chart, {
    			type: 'bar',
    			data: {
    				labels: [historyData[0].date, historyData[1].date, historyData[2].date, historyData[3].date, historyData[4].date],
    				datasets: [
    				{
    					label: "g",
    					backgroundColor: [color[0], color[0],color[0],color[0],color[0]],
    					data: [historyData[0].sumConsumeWeight, historyData[1].sumConsumeWeight, historyData[2].sumConsumeWeight, historyData[3].sumConsumeWeight, historyData[4].sumConsumeWeight]
    				}
    				]
    			},
    			options: {
    				legend: { display: false },
    				title: {
    					display: true,
    					text: historyTitle[index]
    				}
    			}
    		});
    	}    	
    }

    // Draw all the nutrients chart with selected food is highlighted
    function drawAllNutrients(milk, orange, meat, broccoli, fish){
    	drawNutrientsDigram(milk, 0, colorArray);
    	drawNutrientsDigram(orange, 1, colorArray);
    	drawNutrientsDigram(meat, 2, colorArray);
    	drawNutrientsDigram(broccoli, 3, colorArray);
    	drawNutrientsDigram(fish, 4, colorArray);
    }

    // Draw each food each nutreints contribution char
    function drawNutrientsDigram(nutrionData, index, colorArray){
    	console.log(nutrionData);
    	for(i = 0; i < nutrionData.length; i++){
    		var chart = document.getElementById(nutrientsIntakeBar[index]);
    		chart.style.display = "inline-block";
    		var myChart = new Chart(chart, {
    			type: 'bar',
    			data: {
    				labels: [nutrionLabels[0], nutrionLabels[1], nutrionLabels[2], nutrionLabels[3], nutrionLabels[4]],
    				datasets: [
    				{
    					label: nutrientUnit[index],
    					backgroundColor: [colorArray[0], colorArray[1],colorArray[2],colorArray[3],colorArray[4]],
    					data: [nutrionData[0], nutrionData[1], nutrionData[2], nutrionData[3], nutrionData[4]]
    				}
    				]
    			},
    			options: {
    				legend: { display: false },
    				title: {
    					display: true,
    					text: nutritionTitle[index]
    				}
    			}
    		});
    	}    	
    }

    // Hide all the nutrients chart
    function hideAllNutrients(){
    	document.getElementById("chartDiv").style.display = "none";
    	for(i = 0; i < nutrientsIntakeBar.length; i++){
    		var chart = document.getElementById(nutrientsIntakeBar[i]);
    		chart.style.display = "none";
    	}
    }

    //Hide specific nutrients chart
    function hideNutrients(index, milk, orange, meat, broccoli, fish){
    	colorArray[index] = "#4CC3D9";
    	drawNutrientsDigram(milk, 0, colorArray);
    	drawNutrientsDigram(orange, 1, colorArray);
    	drawNutrientsDigram(meat, 2, colorArray);
    	drawNutrientsDigram(broccoli, 3, colorArray);
    	drawNutrientsDigram(fish, 4, colorArray);
    }

    //Hide history chart
    function hideHistory(index){
    	var chart = document.getElementById(historyBar[index]);
    	chart.style.display = "none";
    }

    function setDivDisplay(){
    	document.getElementById("chartDiv").style.display = "inline-block";
    	document.getElementById("chartDiv").style.width = "20%";
    	document.getElementById("chartDiv").style.margin = "35px";
    }

</script>
</body>
</html>