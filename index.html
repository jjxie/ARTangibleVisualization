<!doctype html>
<html>
<head>
	<title>Visualization of food consumption and daily nutrition</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="client.js"></script>
  <!-- include A-Frame obviously -->
  <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>
  <!-- include ar.js for A-Frame -->
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script> 
  <script src="js/three.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script>
    // AFRAME.registerGeometry('example', {
    //   schema: {
    //     vertices: {
    //       default: ['0 0 0', '5 0 0', '6.54 4.75 0', '2.50 7.69 0', '-1.54 4.75 0'],
    //     }
    //   },

    //   init: function (data) {
    //     var geometry = new THREE.Geometry();
    //     geometry.groupsNeedUpdate = true;
    //     geometry.vertices = data.vertices.map(function (vertex) {
    //       var points = vertex.split(' ').map(function(x){return parseInt(x);});
    //       return new THREE.Vector3(points[0], points[1], points[2], points[4], points[5]);
    //     });
    //     geometry.computeBoundingBox();
    //     geometry.faces.push(new THREE.Face3(3, 4, 5));
    //     geometry.mergeVertices();
    //     geometry.computeFaceNormals();
    //     geometry.computeVertexNormals();
    //     this.geometry = geometry;
    //   }
    // });
  </script>

  <style>
  body { margin: 5px; padding: 0; box-sizing: border-box; }
  body { font: 13px Helvetica, Arial; }
  form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
  form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
  form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
  #scale-data-milk, #scale-data-broccoli, #scale-data-fish, #scale-data-orange, #scale-data-meat { font-size: 28px; pointer-events: auto!important;}
  .progress-bar-vertical { display: inline-block; width: 150px; height: 40px; -webkit-transform: rotate(-90deg); /* Chrome, Safari, Opera */ transform: rotate(-90deg);}
</style>
</head> 
<body>

  <a-scene embedded arjs='sourceType: webcam;'>

    <!-- define a camera which will move according to the marker position -->

    <!-- marker milk -->
    <a-marker preset='custom' type='pattern' url='https://raw.githubusercontent.com/jjxie/SocketSensorTest/master/ARmarkers/milk.patt'>
      <a-sphere id="milk3D" position='0 0.1 0' radius="0.2" material="opacity: 1.0; color: #4CC3D9"></a-sphere>
      <a-text id="milkText" position="1 1 0.5" rotation="-90 0 -180"  value="Milk" color="#D05A6E"></a-text>
      <a-text id="milkWeight" position="1 1 0.5" rotation="-90 0 -180" value="0 g" color="#D05A6E"></a-text>
      <a-box id="milkHistory1" position='-0.5 1 0' depth="0.1" height="0.2" width="0.1" color="#4CC3D9" visible="false"></a-box>
      <a-box id="milkHistory2" position='-0.3 1 0' depth="0.1" height="0.3" width="0.1" color="#4CC3D9" visible="false"></a-box>
      <a-box id="milkHistory3" position='0 1 0' depth="0.1" height="0.3" width="0.1" color="#4CC3D9" visible="false"></a-box>
      <a-box id="milkHistory4" position='0.3 1 0' depth="0.1" height="0.7" width="0.1" color="#4CC3D9" visible="false"></a-box>
      <a-box id="milkHistory5" position='0.5 1 0' depth="0.1" height="0.1" width="0.1" color="#4CC3D9" visible="false"></a-box>
    </a-marker>

    <!-- marker orange -->
    <a-marker preset='custom' type='pattern' url='https://raw.githubusercontent.com/jjxie/SocketSensorTest/master/ARmarkers/orange.patt'>
      <a-sphere id="orange3D" position='0 0.1 0' radius="0.2" material="color: #F4A95C"></a-sphere>
      <a-text id="orangeText" position="1 1 0.5" rotation="-90 0 -180" value="Orange" color="#D05A6E"></a-text>
      <a-text id="orangeWeight" position="1 1 0.5" rotation="-90 0 -180" value="0 g" color="#D05A6E"></a-text>
      <a-box id="orangeHistory1" position='-0.5 1 0' depth="0.1" height="0.2" width="0.1" color="#F4A95C" visible="false"></a-box>
      <a-box id="orangeHistory2" position='-0.3 1 0' depth="0.1" height="0.3" width="0.1" color="#F4A95C" visible="false"></a-box>
      <a-box id="orangeHistory3" position='0 1 0' depth="0.1" height="0.3" width="0.1" color="#F4A95C" visible="false"></a-box>
      <a-box id="orangeHistory4" position='0.3 1 0' depth="0.1" height="0.7" width="0.1" color="#F4A95C" visible="false"></a-box>
      <a-box id="orangeHistory5" position='0.5 1 0' depth="0.1" height="0.1" width="0.1" color="#F4A95C" visible="false"></a-box>
    </a-marker>

    <!-- marker meat -->
    <a-marker preset='custom' type='pattern' url='https://raw.githubusercontent.com/jjxie/SocketSensorTest/master/ARmarkers/meat.patt'>
      <a-sphere id="meat3D" position='0 0.1 0' radius="0.2" color="#D64434"></a-sphere>
      <a-text id="meatText" position="1 1 0.5" rotation="-90 0 -180" value="Meat" color="#D05A6E"></a-text>
      <a-text id="meatWeight" position="1 1 0.5" rotation="-90 0 -180" value="0 g" color="#D05A6E"></a-text>
      <a-box id="meatHistory1" position='-0.5 1 0' depth="0.1" height="0.2" width="0.1" color="#D64434" visible="false"></a-box>
      <a-box id="meatHistory2" position='-0.3 1 0' depth="0.1" height="0.3" width="0.1" color="#D64434" visible="false"></a-box>
      <a-box id="meatHistory3" position='0 1 0' depth="0.1" height="0.3" width="0.1" color="#D64434" visible="false"></a-box>
      <a-box id="meatHistory4" position='0.3 1 0' depth="0.1" height="0.7" width="0.1" color="#D64434" visible="false"></a-box>
      <a-box id="meatHistory5" position='0.5 1 0' depth="0.1" height="0.1" width="0.1" color="#D64434" visible="false"></a-box>
    </a-marker>

    <!-- marker broccoli -->
    <a-marker preset='custom' type='pattern' url='https://raw.githubusercontent.com/jjxie/SocketSensorTest/master/ARmarkers/broccoli.patt'>
      <a-sphere id ="broccoli3D" position="0 0.1 0" radius="0.2" color="#1B813E"></a-sphere>
      <a-text id="broccoliText" position="1 1 0.5" rotation="-90 0 -180" value="Broccoli" color="#D05A6E"></a-text>
      <a-text id="broccoliWeight" position="1 1 0.5" rotation="-90 0 -180" value="0 g" color="#D05A6E"></a-text>
      <a-box id="broccoliHistory1" position='-0.5 1 0' depth="0.1" height="0.2" width="0.1" color="#1B813E" visible="false"></a-box>
      <a-box id="broccoliHistory2" position='-0.3 1 0' depth="0.1" height="0.3" width="0.1" color="#1B813E" visible="false"></a-box>
      <a-box id="broccoliHistory3" position='0 1 0' depth="0.1" height="0.3" width="0.1" color="#1B813E" visible="false"></a-box>
      <a-box id="broccoliHistory4" position='0.3 1 0' depth="0.1" height="0.7" width="0.1" color="#1B813E" visible="false"></a-box>
      <a-box id="broccoliHistory5" position='0.5 1 0' depth="0.1" height="0.1" width="0.1" color="#1B813E" visible="false"></a-box>
    </a-marker>

    <!-- marker fish -->
    <a-marker preset='custom' type='pattern' url='https://raw.githubusercontent.com/jjxie/SocketSensorTest/master/ARmarkers/fish.patt'>
      <a-sphere id="fish3D" position="0 0.1 0" radius="0.2" color="#99A6A6"></a-sphere>
      <a-text id="fishText" position="1 1 0.5" rotation="-90 0 -180" value="Fish" color="#D05A6E"></a-text>
      <a-text id="fishWeight" position="1 2 0.5" rotation="-90 0 -180" value="0 g" color="#D05A6E"></a-text>
      <a-box id="fishHistory1" position='-0.5 1 0' depth="0.1" height="0.2" width="0.1" color="#99A6A6" visible="false"></a-box>
      <a-box id="fishHistory2" position='-0.3 1 0' depth="0.1" height="0.3" width="0.1" color="#99A6A6" visible="false"></a-box>
      <a-box id="fishHistory3" position='0 1 0' depth="0.1" height="0.3" width="0.1" color="#99A6A6" visible="false"></a-box>
      <a-box id="fishHistory4" position='0.3 1 0' depth="0.1" height="0.7" width="0.1" color="#99A6A6" visible="false"></a-box>
      <a-box id="fishHistory5" position='0.5 1 0' depth="0.1" height="0.1" width="0.1" color="#99A6A6" visible="false"></a-box>
    </a-marker>

    <!-- camera -->
    <a-entity camera></a-entity>

  </a-scene>
  
  <div>
    <button id="reset" type="button" onclick="alert('Hello world!')">Click Me!</button>
  </div>

  <script>
    var socket = io.connect('https://192.168.0.100:3000',{secure: true});
    //Get AR scene
    var sceneEl = document.querySelector('a-scene');

    sceneEl.querySelector('#milk3D').addEventListener('click', function (evt) {
      console.log('This 2D element was clicked!');
    });

    // Milk selection show detailed information
    socket.on('milkIsSelected', function(milkHistoryData){
      // console.log("Milk is selected!");
      sceneEl.querySelector('#milkText').setAttribute('value', "Selected"); 
      for(var i =0; i< Object.keys(milkHistoryData).length; i++){
        console.log(milkHistoryData[i].date);
        console.log(milkHistoryData[i].time);
        console.log(milkHistoryData[i].weight);
      } 
      sceneEl.querySelector('#milkHistory1').setAttribute("visible",true); 
      sceneEl.querySelector('#milkHistory2').setAttribute("visible",true); 
      sceneEl.querySelector('#milkHistory3').setAttribute("visible",true); 
      sceneEl.querySelector('#milkHistory4').setAttribute("visible",true); 
      sceneEl.querySelector('#milkHistory5').setAttribute("visible",true); 
    });

    socket.on('milkIsDeselected', function(txt){
      // console.log("Milk is deselected!");
      sceneEl.querySelector('#milkText').setAttribute('value', "Deselected");  
      sceneEl.querySelector('#milkHistory1').setAttribute("visible",false); 
      sceneEl.querySelector('#milkHistory2').setAttribute("visible",false); 
      sceneEl.querySelector('#milkHistory3').setAttribute("visible",false); 
      sceneEl.querySelector('#milkHistory4').setAttribute("visible",false); 
      sceneEl.querySelector('#milkHistory5').setAttribute("visible",false);   
    });

    // Orange selection show detailed information
    socket.on('orangeIsSelected', function(orangeHistoryData){
      // console.log("Orange is selected!");
      sceneEl.querySelector('#orangeText').setAttribute('value', "Selected"); 
      sceneEl.querySelector('#orangeHistory1').setAttribute("visible",true); 
      sceneEl.querySelector('#orangeHistory2').setAttribute("visible",true); 
      sceneEl.querySelector('#orangeHistory3').setAttribute("visible",true); 
      sceneEl.querySelector('#orangeHistory4').setAttribute("visible",true); 
      sceneEl.querySelector('#orangeHistory5').setAttribute("visible",true);     
    });

    socket.on('orangeIsDeselected', function(txt){
      // console.log("Orange is deselected!");
      sceneEl.querySelector('#orangeText').setAttribute('value', "Deselected");  
      sceneEl.querySelector('#orange').setAttribute('color', '#000000'); 
      sceneEl.querySelector('#orangeHistory1').setAttribute("visible",false); 
      sceneEl.querySelector('#orangeHistory2').setAttribute("visible",false); 
      sceneEl.querySelector('#orangeHistory3').setAttribute("visible",false); 
      sceneEl.querySelector('#orangeHistory4').setAttribute("visible",false); 
      sceneEl.querySelector('#orangeHistory5').setAttribute("visible",false);    
    });

    // Meat selection show detailed information
    socket.on('meatIsSelected', function(meatHistoryData){
      // console.log("Meat is selected!");   
      sceneEl.querySelector('#meatText').setAttribute('value', "Selected"); 
      sceneEl.querySelector('#meatHistory1').setAttribute("visible",true); 
      sceneEl.querySelector('#meatHistory2').setAttribute("visible",true); 
      sceneEl.querySelector('#meatHistory3').setAttribute("visible",true); 
      sceneEl.querySelector('#meatHistory4').setAttribute("visible",true); 
      sceneEl.querySelector('#meatHistory5').setAttribute("visible",true);
    });

    socket.on('meatIsDeselected', function(txt){ 
      // console.log("Meat is deselected!");
      sceneEl.querySelector('#meatText').setAttribute('value', "Deselected"); 
      sceneEl.querySelector('#meatHistory1').setAttribute("visible",false); 
      sceneEl.querySelector('#meatHistory2').setAttribute("visible",false); 
      sceneEl.querySelector('#meatHistory3').setAttribute("visible",false); 
      sceneEl.querySelector('#meatHistory4').setAttribute("visible",false); 
      sceneEl.querySelector('#meatHistory5').setAttribute("visible",false);
    });

    // Broccoli selection show detailed information
    socket.on('broccoliIsSelected', function(broccoliHistoryData){   
      // console.log("Broccoli is selected!");
      sceneEl.querySelector('#broccoliText').setAttribute('value', "Selected"); 
      sceneEl.querySelector('#broccoliHistory1').setAttribute("visible",true); 
      sceneEl.querySelector('#broccoliHistory2').setAttribute("visible",true); 
      sceneEl.querySelector('#broccoliHistory3').setAttribute("visible",true); 
      sceneEl.querySelector('#broccoliHistory4').setAttribute("visible",true); 
      sceneEl.querySelector('#broccoliHistory5').setAttribute("visible",true);
    });

    socket.on('broccoliIsDeselected', function(txt){ 
      // console.log("Broccoli is deselected!");
      sceneEl.querySelector('#broccoliText').setAttribute('value', "Deselected");
      sceneEl.querySelector('#broccoliHistory1').setAttribute("visible",false); 
      sceneEl.querySelector('#broccoliHistory2').setAttribute("visible",false); 
      sceneEl.querySelector('#broccoliHistory3').setAttribute("visible",false); 
      sceneEl.querySelector('#broccoliHistory4').setAttribute("visible",false); 
      sceneEl.querySelector('#broccoliHistory5').setAttribute("visible",false);
    });

    // Fish selection show detailed information
    socket.on('fishIsSelected', function(fishHistoryData){
      // console.log("Fish is selected!");
      sceneEl.querySelector('#fishText').setAttribute('value', "Selected");
      sceneEl.querySelector('#fishHistory1').setAttribute("visible",true); 
      sceneEl.querySelector('#fishHistory2').setAttribute("visible",true); 
      sceneEl.querySelector('#fishHistory3').setAttribute("visible",true); 
      sceneEl.querySelector('#fishHistory4').setAttribute("visible",true); 
      sceneEl.querySelector('#fishHistory5').setAttribute("visible",true);   
    });

    socket.on('fishIsDeselected', function(txt){ 
      // console.log("Fish is deselected!");
      sceneEl.querySelector('#fishText').setAttribute('value', "Deselected"); 
      sceneEl.querySelector('#fishHistory1').setAttribute("visible",false); 
      sceneEl.querySelector('#fishHistory2').setAttribute("visible",false); 
      sceneEl.querySelector('#fishHistory3').setAttribute("visible",false); 
      sceneEl.querySelector('#fishHistory4').setAttribute("visible",false); 
      sceneEl.querySelector('#fishHistory5').setAttribute("visible",false);  
    });


    // Show milk weight in AR from scale
    socket.on('scaleDataMilk', function(milk){
      var weight = milk.toString() + " g";
      sceneEl.querySelector('#milkWeight').setAttribute('value', weight);
    });

    // Show orange weight in AR from scale
    socket.on('scaleDataOrange', function(orange){
      var weight = orange.toString() + " g";
      sceneEl.querySelector('#orangeWeight').setAttribute('value', weight);
    }); 

    // Show meat weight in AR from scale
    socket.on('scaleDataMeat', function(meat){
      var weight = meat.toString() + " g";
      sceneEl.querySelector('#meatWeight').setAttribute('value', weight);
    });

    // Show broccoli weight in AR from scale
    socket.on('scaleDataBroccoli', function(broccoli){
      var weight = broccoli.toString() + " g";
      sceneEl.querySelector('#broccoliWeight').setAttribute('value', weight);
    });

    // Show fish weight in AR from scale
    socket.on('scaleDataFish', function(fish){
      var weight = fish.toString() + " g";
      sceneEl.querySelector('#fishWeight').setAttribute('value', weight);
    });



    // Show manually changed weight of milk in AR
    socket.on('manualDataMilk', function(milk){
      var weight = milk.toString() + " g";
      sceneEl.querySelector('#milkWeight').setAttribute('value', weight);
    });

    // Show manually changed weight of orange in AR
    socket.on('manualDataOrange', function(orange){
      var weight = orange.toString() + " g";
      sceneEl.querySelector('#orangeWeight').setAttribute('value', weight);
    });

    // Show manually changed weight of meat in AR
    socket.on('manualDataMeat', function(meat){
      var weight = meat.toString() + " g";
      sceneEl.querySelector('#meatWeight').setAttribute('value', weight);
    });

    // Show manually changed weight of broccoli in AR
    socket.on('manualDataBroccoli', function(broccoli){
      var weight = broccoli.toString() + " g";
      sceneEl.querySelector('#broccoliWeight').setAttribute('value', weight);
    });



    // If content updates, get all the content again
    socket.on('update content', function(data){
      var buffer = new Uint8Array(data);
      var fileString= String.fromCharCode.apply(null, buffer);
      var obj = JSON.parse(fileString)
      console.log(obj);
      for (i = 0; i < obj.length; i++) {
        $('#messages').append($('<li>').text(obj[i].ID));   
      }    
    });

    // Get the intial content when connected for the first time
    socket.on('initial content', function(data){
      var buffer = new Uint8Array(data);
      var fileString= String.fromCharCode.apply(null, buffer);
      var obj = JSON.parse(fileString)
      for (i = 0; i < obj.length; i++) {
        $('#messages').append($('<li>').text(obj[i].ID));
      }
    });

  </script>
</body>
</html>